var de=Object.defineProperty,me=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var oe=(t,s,o)=>s in t?de(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o,G=(t,s)=>{for(var o in s||(s={}))he.call(s,o)&&oe(t,o,s[o]);if(ne)for(var o of ne(s))pe.call(s,o)&&oe(t,o,s[o]);return t},J=(t,s)=>me(t,ue(s));import{r as i,j as X,N as F,a as fe,u as w,b as ge,O as ve,L as k,c as T,R as Ne,d as D,e as xe,f as ye,B as De}from"./vendor.7a1b9b76.js";const be=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))d(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const h of u.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&d(h)}).observe(document,{childList:!0,subtree:!0});function o(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerpolicy&&(u.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?u.credentials="include":r.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function d(r){if(r.ep)return;r.ep=!0;const u=o(r);fetch(r.href,u)}};be();const B=i.exports.createContext(),Z=()=>i.exports.useContext(B);const e=X.exports.jsx,n=X.exports.jsxs,$=X.exports.Fragment,Ce=()=>{const{isLoggedIn:t,currentUser:s,removeUser:o}=Z(),d=new Date;return n("nav",{className:"NavMain",children:[e(F,{className:"logo",to:"/",children:"MO"}),t&&n($,{children:[n("div",{className:"navItems",children:[e(F,{className:"menu",to:"/profile",children:s&&s.email}),e(F,{className:"menu",to:`/meals/${d.toISOString()}`,children:"Mes repas"}),e(F,{className:"menu",to:"/foods",children:"Mes Aliments"})]}),e("div",{className:"navLogout",children:e("button",{onClick:o,children:"D\xE9connexion"})})]}),!t&&e($,{children:n("div",{className:"navActions",children:[e(F,{to:"/signin",children:"Connexion"}),e(F,{to:"/signup",children:"Inscription"})]})})]})},Ee="mobile",Se="desktop";function ee(){const[t,s]=i.exports.useState("");return i.exports.useEffect(()=>{let o=!1;if("maxTouchPoints"in navigator)o=navigator.maxTouchPoints>0;else if("msMaxTouchPoints"in navigator)o=navigator.msMaxTouchPoints>0;else{const r=window.matchMedia&&matchMedia("(pointer:coarse)");if(r&&r.media==="(pointer:coarse)")o=!!r.matches;else if("orientation"in window)o=!0;else{var d=navigator.userAgent;o=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(d)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(d)}}s(o?Ee:Se)}),t}var we="/assets/mo-0-semaine.326bdcf6.png",_e="/assets/mo-0-semaine-mobile.ded71e7b.png",Fe="/assets/mo-1-categories-aliment.2a2bac9d.png",ke="/assets/mo-2-liste-aliments.b4848a05.png";const Le=()=>{const t=ee();return n("div",{className:"home-page",children:[e("h1",{children:"Adoptez M O !"}),n("div",{className:"home-block",children:[n("div",{className:"text",children:[e("p",{className:"mo",children:"\xAB Meal Organizer \xBB"}),e("p",{children:"Avec MO, planifiez vos repas des semaines \xE0 venir"})]}),e("div",{className:"img",children:t==="mobile"?e("img",{src:_e,alt:"Semaine planifi\xE9e de repas"}):e("img",{src:we,alt:"Semaine planifi\xE9e de repas"})})]}),n("div",{className:"home-block",children:[n("div",{className:"text",children:[e("p",{children:"Vous pouvez cr\xE9er les aliments de votre quotidien."}),e("p",{children:"Ils sont associ\xE9s \xE0 une cat\xE9gorie reconnaissable \xE0 sa couleur."})]}),n("div",{className:"img",children:[e("img",{className:"duo",src:Fe,alt:"Cr\xE9ation d'alimment - Cat\xE9gories des aliments"}),e("img",{className:"duo",src:ke,alt:"Cr\xE9ation d'alimment - Cat\xE9gories des aliments"})]})]}),n("div",{className:"home-block",children:[n("div",{className:"text",children:[e("p",{children:"Une fois vos aliments cr\xE9\xE9s, composez vos repas jour par jour."}),e("p",{children:"\xC0 chaque heure du jour son repas."}),e("p",{children:"MO s'adapte \xE0 votre rythme de vie."})]}),e("div",{className:"img"})]})]})},re=t=>{const[s,o]=i.exports.useState(t);return[s,r=>{o(J(G({},s),{[r.target.name]:r.target.value}))}]},O=fe.create({baseURL:"https://meal-organizer.herokuapp.com",withCredentials:!0});//! Error handling to use in the catch
function j(t){throw t.response.data&&console.log(t.response&&t.response.data),t}const f=J(G({},O),{signup(t){return O.post("/api/auth/signup",t).then(s=>s.data).catch(j)},isLoggedIn(){return O.get("/api/auth/is-loggedin").then(t=>t.data).catch(j)},signin(t){return O.post("/api/auth/signin",t).then(s=>s.data).catch(j)},signout(){return O.get("/api/auth/signout").then(t=>t.data).catch(j)}});const Ie=()=>{const[{email:t,password:s},o]=re({email:"",password:""}),[d,r]=i.exports.useState(null),u=w(),{authenticateUser:h}=Z(),g=m=>{m.preventDefault();const N=new Date;f.signin({email:t,password:s}).then(v=>{h(()=>u(`/meals/${N.toISOString()}`))}).catch(v=>{r(v.response.data)})};return n($,{children:[d&&e("h3",{className:"error",children:d.message}),n("form",{onSubmit:g,children:[e("h2",{className:"title",children:"Connexion"}),n("div",{className:"form-group",children:[e("label",{htmlFor:"email",children:"Email :"}),e("br",{}),e("input",{className:"form-control",type:"email",id:"email",name:"email",onChange:o,value:t})]}),n("div",{className:"form-group",children:[e("label",{htmlFor:"password",children:"Mot de passe :"}),e("br",{}),e("input",{className:"form-control",type:"password",id:"password",name:"password",onChange:o,value:s})]}),e("button",{className:"submit-btn",children:"Connexion"})]})]})},Me=()=>e(Ie,{}),Te=()=>{const[t,s]=re({name:"",email:"",password:""}),[o,d]=i.exports.useState(null),r=w(),u=h=>{h.preventDefault(),f.signup(t).then(()=>{r("/signin")}).catch(g=>{d(g.response.data)})};return n($,{children:[o&&e("h3",{className:"error",children:o.message}),n("form",{onSubmit:u,children:[e("h2",{className:"title",children:"S'inscrire"}),n("div",{className:"form-group",children:[e("label",{htmlFor:"name",children:"Nom :"}),e("br",{}),e("input",{className:"form-control",onChange:s,value:t.name,type:"text",id:"name",name:"name"})]}),n("div",{className:"form-group",children:[e("label",{htmlFor:"email",children:"Email :"}),e("br",{}),e("input",{className:"form-control",onChange:s,value:t.email,type:"email",id:"email",name:"email"})]}),n("div",{className:"form-group",children:[e("label",{htmlFor:"password",children:"Mot de passe :"}),e("br",{}),e("input",{className:"form-control",onChange:s,value:t.password,type:"password",id:"password",name:"password"})]}),e("button",{className:"submit-btn",children:"S'inscrire"})]})]})},$e=()=>e(Te,{}),Oe=()=>e("div",{children:e("p",{children:"This is a protected profile"})}),Ae=()=>{const{isLoggedIn:t,isLoading:s}=Z();return s?e("p",{children:"Loading..."}):t?e(ve,{}):e(ge,{to:"/signin"})},Be=({food:t,viewClbk:s,editClbk:o,deleteClbk:d})=>{var r;return n("div",{className:"box",children:[n("div",{className:"left-items",children:[e("div",{className:"catColor",style:{backgroundColor:(r=t.category)==null?void 0:r.color}}),e("span",{className:"food",children:t.name})]}),n("div",{className:"actionBtn",children:[e("span",{children:e(k,{to:`/foods/food/view/${t._id}`,children:e("i",{className:"fa-solid fa-eye"})})}),e("span",{children:e(k,{to:`/foods/food/edit/${t._id}`,children:e("i",{className:"fa-solid fa-pencil"})})}),e("span",{children:e("i",{id:t._id,className:"fa-solid fa-trash-can",onClick:d})})]})]},t._id)};const je=()=>{const[t,s]=i.exports.useState([]),[o,d]=i.exports.useState(null),[r,u]=i.exports.useState(!1);i.exports.useEffect(()=>{f.get("/foods").then(({data:m})=>{s(m)})},[r]),i.exports.useEffect(()=>{f.get("/foods/categories").then(m=>{console.log("response :>> ",m),d(m.data)})},[]);const h=m=>{f.delete(`/foods/food/${m.target.id}`).then(N=>{s(t.filter(v=>v._id!==m.target.id))})},g=m=>{console.log("filtering... :>> "),m.preventDefault(),f.get(`/foods/${m.target.id}`).then(N=>{console.log("***response*** :>> ",N),s(N.data)})};return n("div",{className:"container",children:[n("div",{className:"foodTitle",children:[e("h2",{children:"Tous mes Aliments "}),e("span",{className:"addFood",children:e(k,{to:"/foods/food/new",children:e("i",{className:"fa-solid fa-plus"})})})]}),n("div",{className:"filters",children:[e("button",{className:"allFoodBtn",onClick:()=>u(!r),children:"Tous"}),o&&o.map(m=>e("button",{id:m._id,className:"filterBtn",style:{backgroundColor:m.color},onClick:g,children:m.name},m._id))]}),t&&t.map(m=>e(Be,{food:m,viewClbk:!0,editClbk:!0,deleteClbk:h},m._id))]})},Ue=()=>{var g,m;const[t,s]=i.exports.useState({}),[o,d]=i.exports.useState([]),{id:r}=T(),u=w();i.exports.useEffect(()=>{f.get(`/foods/food/${r}`).then(N=>{console.log("***response*** :>> ",N),s(N.data)}).catch(N=>console.error(N))},[]);const h=N=>{f.delete(`/foods/food/${N.target.id}`).then(v=>{d(o.filter(c=>c._id!==N.target.id)),u("/foods")})};return e($,{children:n("div",{className:"container",children:[n("div",{className:"nameWrapper",children:[e("div",{className:"nameLeft",children:e("h2",{className:"foodName",children:t==null?void 0:t.name})}),n("div",{className:"actionsBtn",children:[e(k,{to:`/foods/food/edit/${r}`,children:e("i",{className:"fa-solid fa-pencil"})}),e("i",{id:r,className:"fa-solid fa-trash-can",onClick:h})]})]}),n("div",{className:"categoryWrapper",children:[n("div",{className:"categoryLeft",children:[e("p",{children:e("b",{children:"Cat\xE9gorie : "})}),e("span",{children:(g=t.category)==null?void 0:g.name})]}),e("div",{className:"catColor",style:{backgroundColor:(m=t.category)==null?void 0:m.color}})]}),n("div",{className:"descriptionWrapper",children:[e("p",{children:e("b",{children:"Description :"})}),e("p",{children:t.description})]}),e("div",{className:"return",children:e(F,{to:"/foods",className:"submit-btn",children:"Retour"})})]})})},Re=({action:t})=>{const[s,o]=i.exports.useState(""),[d,r]=i.exports.useState(null),[u,h]=i.exports.useState(""),[g,m]=i.exports.useState([]),N=w();return i.exports.useEffect(()=>{f.get("/foods/categories").then(c=>{console.log("response :>> ",c),m(c.data)})},[]),n("form",{onSubmit:c=>{c.preventDefault();const x={name:s,category:d,description:u};f.post("/foods/food",x).then(y=>{console.log("response :>> ",y),N("/foods")}).catch(y=>console.error(y))},children:[e("h2",{className:"title",children:"Cr\xE9er un Aliment"}),n("div",{className:"form-group",children:[e("label",{htmlFor:"name",children:"Nom :"}),e("br",{}),e("input",{className:"form-control",type:"text",name:"name",id:"name",value:s,onChange:c=>o(c.target.value)})]}),n("div",{className:"form-group",children:[e("label",{htmlFor:"category",children:"Cat\xE9gorie :"}),e("br",{}),n("select",{className:"form-control",name:"category",id:"category",onChange:c=>r(c.target.value),children:[e("option",{value:"-1",disabled:!0,selected:!0,children:"Selectionnez une cat\xE9gorie"}),g&&g.map(c=>e("option",{value:c._id,children:c.name},c._id))]})]}),n("div",{className:"form-group",children:[e("label",{htmlFor:"description",children:"Description :"}),e("br",{}),e("textarea",{className:"form-control",name:"description",id:"description",value:u,onChange:c=>h(c.target.value),cols:"70",rows:"5"})]}),e("button",{className:"submit-btn",children:"Cr\xE9er"})]})},Pe=()=>{const[t,s]=i.exports.useState(""),[o,d]=i.exports.useState(""),[r,u]=i.exports.useState(""),[h,g]=i.exports.useState([]),{id:m}=T(),N=w();i.exports.useEffect(()=>{f.get("/foods/categories").then(c=>{console.log("response :>> ",c),g(c.data)})},[]),i.exports.useEffect(()=>{f.get(`/foods/food/${m}`).then(c=>{console.log("response :>>",c.data),s(c.data.name),d(c.data.category._id),u(c.data.description)})},[]);const v=c=>{c.preventDefault();const x={name:t,category:o,description:r};f.patch(`/foods/food/${m}`,x).then(y=>{console.log("response :>> ",y),N("/foods")}).catch(y=>console.error(y))};return n("form",{children:[e("h2",{className:"title",children:"Editer l'aliment"}),n("div",{className:"form-group",children:[e("label",{htmlFor:"name",children:"Nom :"}),e("br",{}),e("input",{type:"text",name:"name",id:"name",className:"form-control",value:t,onChange:c=>s(c.target.value)})]}),n("div",{className:"form-group",children:[e("label",{htmlFor:"name",children:"Cat\xE9gorie :"}),e("br",{}),e("select",{name:"category",id:"category",className:"form-control",value:o,onChange:c=>d(c.target.value),children:h&&h.map(c=>e("option",{value:c._id,children:c.name},c._id))})]}),n("div",{className:"form-group",children:[e("label",{htmlFor:"name",children:"Description :"}),e("br",{}),e("textarea",{className:"form-control",name:"description",id:"description",value:r,onChange:c=>u(c.target.value),cols:"70",rows:"5"})]}),e("button",{className:"submit-btn",onClick:v,children:"Mettre \xE0 jour"})]})},te=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function ze(t){const s=t.toISOString().slice(0,10);return new Date(s)}function We(t){const s=t.slice(0,10);return new Date(s)}function U(t){let s;if(typeof t=="string")s=We(t);else if(t instanceof Date)s=ze(t);else return-1;const o=s.getDay(),d=(te.indexOf("Monday")-o-te.length)%te.length;let r=new Date(s);return r.setDate(s.getDate()+d),r}function Ve(t){const s=[],o=U(t);s.push(o);for(let d=1;d<7;d++){let r=new Date(o);r.setDate(o.getDate()+d),s.push(r)}return s}function qe(t){const s=U(t),o={previous:null,next:null};let d=new Date(s);d.setDate(s.getDate()-7),o.previous=d;let r=new Date(s);return r.setDate(s.getDate()+7),o.next=r,o}const He=({dayDate:t,meals:s,deleteClbk:o})=>{const d=w(),r=t.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"}),u=h=>{const g=h.target.id;d(`/meals/meal/new/${g}`)};return n("div",{className:"day-container",children:[n("div",{className:"day-title",children:[e("h4",{children:r}),e("i",{id:t.toISOString(),className:"fa-solid fa-plus",onClick:u})]}),e("div",{className:"day-meals",children:s&&s.map((h,g)=>e("div",{children:n("div",{className:"meal-card",children:[n("div",{className:"meal-card-title",children:[e("div",{children:h.type.name}),n("div",{className:"meal-card-btn actionBtn",children:[e("span",{children:e(k,{to:`/meals/meal/edit/${h._id}`,children:e("i",{className:"fa-solid fa-pencil"})})}),e("span",{children:e("i",{id:h._id,className:"fa-solid fa-trash-can",onClick:o})})]})]}),h.foods&&h.foods.map((m,N)=>{var v;return n("div",{className:"food-info",children:[e("div",{className:"catColor",style:{backgroundColor:(v=m.category)==null?void 0:v.color}}),e("span",{className:"meal-food",children:m.name})]},`${m._id}_${g}_${N}`)})]},h._id)},h._id))})]})},le=()=>{let t;const s=T();if(s==null?void 0:s.date)t=U(s.date);else{const v=new Date;t=U(v)}const o=qe(t),d=Ve(t),r=t.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),[u,h]=i.exports.useState([]),[g,m]=i.exports.useState(!1);i.exports.useEffect(()=>{f.get(`/meals/${t.toISOString()}`).then(({data:v})=>{v.forEach(c=>c.sort((x,y)=>x.type.position-y.type.position)),h(v)})},[s.date,g]);const N=v=>{const c=v.target.id;f.delete(`/meals/meal/${c}`).then(x=>{h(u.filter(y=>y._id!==c)),m(!g)})};return n("div",{className:"meals-display",children:[n("h2",{children:["Semaine du ",r]}),n("div",{className:"meal-week-nav",children:[e(k,{className:"actionBtn",to:`/meals/${o.previous.toISOString()}`,children:"Semaine pr\xE9c\xE9dente"}),e(k,{className:"actionBtn",to:`/meals/${o.next.toISOString()}`,children:"Semaine suivante"})]}),e("div",{className:"meal-week",children:u&&d.map((v,c)=>e(He,{dayDate:v,meals:u[c],deleteClbk:N},c))})]})},ie=({category:t,cssClass:s,actionClbk:o})=>e("button",{id:t._id,className:s,style:{backgroundColor:t.color},onClick:o,children:t.name},t._id),ce=({label:t,cssClass:s,actionClbk:o})=>e("button",{className:s,onClick:o,children:t});const Ke=()=>{const{mealDate:t}=T(),s=ee(),[o,d]=i.exports.useState([]),[r,u]=i.exports.useState([]),[h,g]=i.exports.useState([]),[m,N]=i.exports.useState(!1),[v,c]=i.exports.useState(""),[x,y]=i.exports.useState([]),[A,ae]=i.exports.useState(new Date(t.slice(0,10))),[C,L]=i.exports.useState([]),[E,S]=i.exports.useState(null),I=w(),_=i.exports.useContext(B),{currentUser:R}=_,P=A.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"});i.exports.useEffect(()=>{f.get("/meals/mealtypes").then(({data:l})=>{d(l)})},[]),i.exports.useEffect(()=>{f.get("/foods").then(({data:l})=>{u(l)})},[x,C,m]),i.exports.useEffect(()=>{f.get("/foods/categories").then(({data:l})=>{console.log("data :>> ",l),g(l)})},[]);const z=l=>{console.log("--- handleFilter"),l.preventDefault(),f.get(`/foods/${l.target.id}`).then(({data:a})=>{console.log("filtered dbFoods ",a),u(a)})},W=l=>{console.log("--- handleResetFilter"),l.preventDefault(),N(!m)},V=l=>{l.dataTransfer.setData("id",l.target.id),l.dataTransfer.effectAllowed="copy"},q=l=>(l.preventDefault&&l.preventDefault(),l.dataTransfer.dropEffect="copy",!1),H=l=>{S(null),l.target.parentElement.classList.toggle("over"),l.preventDefault(),l.stopPropagation(),l.dataTransfer.dropEffect="copy";const a=l.dataTransfer.getData("id");return l.dataTransfer.dropEffect="copy",x.includes(a)?S({type:"warning",text:"Cet aliment a d\xE9j\xE0 \xE9t\xE9 ajout\xE9"}):(y([...x,a]),f.get(`/foods/food/${a}`).then(({data:p})=>{L([...C,p])})),!1},K=l=>{l.preventDefault(),S(null);const a=l.target.id;return x.includes(a)?S({type:"warning",text:"Cet aliment a d\xE9j\xE0 \xE9t\xE9 ajout\xE9"}):(y([...x,a]),f.get(`/foods/food/${a}`).then(({data:p})=>{L([...C,p])})),!1},Q=l=>{l.preventDefault();const a=l.target.parentElement.id.split("_")[1],p=x.filter(M=>M!=a);y(p);const b=C.filter(M=>M._id!=a);L(b)};return n("form",{className:"meal-form create",onSubmit:l=>{l.preventDefault();const a={type:v,foods:x,user:R.currentUser._id,date:A};f.post("/meals/meal",a).then(p=>{I(`/meals/${t}`)}).catch(p=>{console.error(p),S({type:"error",text:"Erreur, veuillez v\xE9rifier le repas et r\xE9essayer."})})},children:[e("h2",{children:"Cr\xE9ation de repas"}),E&&e("div",{className:`msg ${E.type}`,children:e("span",{children:E.text})}),n("div",{className:"form-content-div",children:[n("div",{className:"meal-date",children:[e("label",{htmlFor:"date",children:"Date : "}),e("span",{children:P})]}),n("div",{className:s==="mobile"?"meal-type mobile":"meal-type",children:[e("label",{htmlFor:"type",children:"Type de repas : "}),e("select",{name:"type",id:"type",value:v,onChange:l=>c(l.target.value),children:o&&o.map(l=>n("option",{value:l._id,children:[l.name," - ",l.timeslot]},l._id))})]}),n("div",{className:"dnd-action-div",children:[n("div",{className:"meal-drag-div",children:[e("h3",{children:"Tous les aliments :"}),n("div",{className:"ref-food-filters",children:[e("div",{className:"filter-intro",children:e("span",{children:"Afficher : "})}),e(ce,{label:"Tous",cssClass:"allFoodBtn",actionClbk:W}),h&&h.map(l=>e(ie,{category:l,cssClass:"filterBtn",actionClbk:z}))]}),e("div",{className:"ref-food-list",children:s==="mobile"?r&&r.map(l=>{var a;return n("div",{value:l._id,className:"draggable-food meal-food mobile",children:[n("div",{className:"food-info",children:[e("div",{className:"catColor",style:{backgroundColor:(a=l.category)==null?void 0:a.color}}),e("span",{className:"food-name",children:l.name})]}),e("button",{id:l._id,className:"actionBtn",onClick:K,children:"Ajouter"})]},l._id)}):r&&r.map(l=>{var a;return n("div",{id:l._id,value:l._id,className:"draggable-food meal-food",draggable:"true",onDragStart:V,children:[e("div",{className:"catColor",style:{backgroundColor:(a=l.category)==null?void 0:a.color}}),e("span",{className:"food-name",children:l.name})]},l._id)})})]}),n("div",{className:"meal-drop-div",children:[n("div",{children:[e("label",{htmlFor:"foods",children:"Aliments du repas : "}),n("div",{name:"foods",id:"foods",value:x,className:"drop-zone",droppable:"true",onDragEnter:l=>l.target.parentElement.classList.toggle("over"),onDragLeave:l=>l.target.parentElement.classList.toggle("over"),onDragOver:q,onDrop:H,children:[e("div",{id:"drop-target1",children:n("span",{children:["D\xE9poser ici les aliments souhait\xE9s depuis la liste"," ",s==="mobile"?"ci-dessous":"ci-contre"," :"]})},"-1"),C&&C.map(l=>{var a;return n("div",{id:`added_${l._id}`,value:l._id,className:"added-food meal-food",children:[n("div",{className:"food-info",children:[e("div",{className:"catColor",style:{backgroundColor:(a=l.category)==null?void 0:a.color}}),e("span",{className:"food-name",children:l.name})]}),e("button",{className:"actionBtn",onClick:Q,children:"Retirer"})]},`added_${l._id}`)})]})]}),e("button",{className:"submit-btn",children:"Ok"})]})]})]})]})},Qe=()=>{const{mealId:t}=T(),s=ee(),[o,d]=i.exports.useState([]),[r,u]=i.exports.useState([]),[h,g]=i.exports.useState([]),[m,N]=i.exports.useState(!1),[v,c]=i.exports.useState(""),[x,y]=i.exports.useState([]),[A,ae]=i.exports.useState(null),[C,L]=i.exports.useState(""),[E,S]=i.exports.useState([]),[I,_]=i.exports.useState(null),R=w(),P=i.exports.useContext(B),{currentUser:z}=P;new Date(C).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),i.exports.useEffect(()=>{f.get(`/meals/meal/${t}`).then(({data:a})=>{c(a.type._id),ae(new Date(a.date.slice(0,10))),L(a.date.slice(0,10));const p=a.foods?a.foods.map(b=>b._id):[];y(p),S(a.foods)})},[]),i.exports.useEffect(()=>{f.get("/meals/mealtypes").then(({data:a})=>{d(a)})},[]),i.exports.useEffect(()=>{f.get("/foods").then(({data:a})=>{u(a)})},[x,E,m]),i.exports.useEffect(()=>{f.get("/foods/categories").then(({data:a})=>{g(a)})},[]);const W=a=>{console.log("--- handleFilter"),a.preventDefault(),f.get(`/foods/${a.target.id}`).then(({data:p})=>{console.log("filtered dbFoods ",p),u(p)})},V=a=>{console.log("--- handleResetFilter"),a.preventDefault(),N(!m)},q=a=>{a.dataTransfer.setData("id",a.target.id),a.dataTransfer.effectAllowed="copy"},H=a=>(a.preventDefault&&a.preventDefault(),a.dataTransfer.dropEffect="copy",!1),K=a=>{_(null),a.target.parentElement.classList.toggle("over"),a.preventDefault(),a.stopPropagation(),a.dataTransfer.dropEffect="copy";const p=a.dataTransfer.getData("id");return a.dataTransfer.dropEffect="copy",x.includes(p)?_({type:"warning",text:"Cet aliment a d\xE9j\xE0 \xE9t\xE9 ajout\xE9"}):(y([...x,p]),f.get(`/foods/food/${p}`).then(({data:b})=>{S([...E,b])})),!1},Q=a=>{a.preventDefault(),_(null);const p=a.target.id;return x.includes(p)?_({type:"warning",text:"Cet aliment a d\xE9j\xE0 \xE9t\xE9 ajout\xE9"}):(y([...x,p]),f.get(`/foods/food/${p}`).then(({data:b})=>{S([...E,b])})),!1},se=a=>{a.preventDefault();const p=a.target.parentElement.id.split("_")[1],b=x.filter(Y=>Y!=p);y(b);const M=E.filter(Y=>Y._id!=p);S(M)};return n("form",{className:"meal-form edit",onSubmit:a=>{a.preventDefault();const p={type:v,foods:x,user:z.currentUser._id,date:new Date(C)};f.patch(`/meals/meal/${t}`,p).then(b=>{R(`/meals/${new Date(A).toISOString()}`)}).catch(b=>{console.error(b),_({type:"error",text:"Erreur, veuillez v\xE9rifier le repas et r\xE9essayer."})})},children:[e("h2",{children:"Modification de repas"}),I&&e("div",{className:`msg ${I.type}`,children:e("span",{children:I.text})}),n("div",{className:"form-content-div",children:[n("div",{className:"meal-date",children:[e("label",{htmlFor:"date",children:"Date : "}),e("input",{type:"date",name:"date",id:"date",value:C,onChange:a=>L(a.target.value)})]}),n("div",{className:s==="mobile"?"meal-type mobile":"meal-type",children:[e("label",{htmlFor:"type",children:"Type de repas : "}),e("select",{name:"type",id:"type",value:v,onChange:a=>c(a.target.value),children:o&&o.map(a=>n("option",{value:a._id,children:[a.name," - ",a.timeslot]},a._id))})]}),n("div",{className:"dnd-action-div",children:[n("div",{className:"meal-drag-div",children:[e("h3",{children:"Tous les aliments :"}),n("div",{className:"ref-food-filters",children:[e("div",{className:"filter-intro",children:e("span",{children:"Afficher : "})}),e(ce,{label:"Tous",cssClass:"allFoodBtn",actionClbk:V}),h&&h.map(a=>e(ie,{category:a,cssClass:"filterBtn",actionClbk:W}))]}),e("div",{className:"ref-food-list",children:s==="mobile"?r&&r.map(a=>{var p;return n("div",{value:a._id,className:"draggable-food meal-food mobile",draggable:"true",children:[n("div",{className:"food-info",children:[e("div",{className:"catColor",style:{backgroundColor:(p=a.category)==null?void 0:p.color}}),e("span",{className:"food-name",children:a.name})]}),e("button",{id:a._id,className:"actionBtn",onClick:Q,children:"Ajouter"})]},a._id)}):r&&r.map(a=>{var p;return n("div",{id:a._id,value:a._id,className:"draggable-food meal-food",draggable:"true",onDragStart:q,children:[e("div",{className:"catColor",style:{backgroundColor:(p=a.category)==null?void 0:p.color}}),e("span",{className:"food-name",children:a.name})]},a._id)})})]}),n("div",{className:"meal-drop-div",children:[n("div",{children:[e("label",{htmlFor:"foods",children:"Aliments du repas : "}),n("div",{name:"foods",id:"foods",value:x,className:"drop-zone",droppable:"true",onDragEnter:a=>a.target.parentElement.classList.toggle("over"),onDragLeave:a=>a.target.parentElement.classList.toggle("over"),onDragOver:H,onDrop:K,children:[e("div",{id:"drop-target1",children:n("span",{children:["D\xE9poser ici les aliments souhait\xE9s depuis la liste"," ",s==="mobile"?"ci-dessous":"ci-contre"," :"]})},"-1"),E&&E.map(a=>{var p;return n("div",{id:`added_${a._id}`,value:a._id,className:"added-food meal-food",children:[n("div",{className:"food-info",children:[e("div",{className:"catColor",style:{backgroundColor:(p=a.category)==null?void 0:p.color}}),e("span",{className:"food-name",children:a.name})]}),e("button",{className:"actionBtn",onClick:se,children:"Retirer"})]},`added_${a._id}`)})]})]}),e("button",{className:"submit-btn",children:"Ok"})]})]})]})]})};function Ye(){return n("div",{className:"App",children:[e(Ce,{}),n(Ne,{children:[e(D,{path:"/",element:e(Le,{})}),e(D,{path:"/signin",element:e(Me,{})}),e(D,{path:"/signup",element:e($e,{})}),n(D,{element:e(Ae,{}),children:[e(D,{path:"/meals",element:e(le,{})}),e(D,{path:"/meals/:date",element:e(le,{})}),e(D,{path:"/meals/meal/new/:mealDate",element:e(Ke,{})}),e(D,{path:"/meals/meal/edit/:mealId",element:e(Qe,{})}),e(D,{path:"/foods",element:e(je,{})}),e(D,{path:"/foods/food/view/:id",element:e(Ue,{})}),e(D,{path:"/foods/food/new",element:e(Re,{})}),e(D,{path:"/foods/food/edit/:id",element:e(Pe,{})}),e(D,{path:"/profile",element:e(Oe,{})})]})]})]})}const Ge=({children:t})=>{const[s,o]=i.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});i.exports.useEffect(()=>{d()},[]);const d=h=>{f.isLoggedIn().then(g=>{o({currentUser:g,isLoading:!1,isLoggedIn:!0}),h&&typeof h=="function"&&h()}).catch(g=>{console.error(g),o({currentUser:null,isLoading:!1,isLoggedIn:!1})})},r=()=>{f.signout().finally(()=>o({currentUser:null,isLoading:!1,isLoggedIn:!1}))},u={currentUser:s.currentUser,isLoading:s.isLoading,isLoggedIn:s.isLoggedIn,removeUser:r,authenticateUser:d};return e(B.Provider,{value:u,children:t})};xe.render(e(ye.StrictMode,{children:e(De,{children:e(Ge,{children:e(Ye,{})})})}),document.getElementById("root"));
